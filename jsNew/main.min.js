function d(a,b){return Math.floor(Math.random()*(b-a))+a}function g(a,b){setTimeout(a.bind(this),b)}function aa(a,b){for(var c in b)a.style[c]=b[c]}function n(a){var b=document.createElement("div");a&&b.setAttribute("id",a);return b}
function p(){var a=r,b=a.s,c=a.o,f=a.v,e=a.t.appendChild(n()),h=e.style,k=Math.floor,m=[],q=[],w=0,E=0,J=0,K=0;aa(e,{position:"absolute",left:"-9999px",width:b+"px",height:c+"px",backgroundImage:"url("+a.w+")"});var S={c:function(a,b){w=a;E=b},i:function(a){m=a},u:function(a,b){h.left=a+"px";h.top=b+"px"},b:function(a){K=a;S.g(K)},g:function(a){a*=b;var e=-k(a/f)*c;h.backgroundPosition=-a%f+"px "+e+"px"},a:function(a){m[a]&&(q=m[a])},h:function(){return K},C:function(){h.display="block"},A:function(){h.display=
"none"},k:function(){e.parentNode.removeChild(e)},j:function(a){a&&(S.g(K+q[k(J)]),J+=a/1E3*m.f,J>=q.length&&(J=0))},f:function(){return m.f},m:function(){return[w/500,E/500]}};return S}
var t="Scavenge for survival;Oops. I am not alone;Obstacles are the key;Nude ones are short sighted;I can destroy obstacles too;Brown jackets are trouble;Each move counts;Harder than I thought;I hate Zetas;It's a long way to the top".split(";"),u="Burguer meat;Zombie fodder;Novice;Inexperienced;Second rate;Mediocre;Handy;Skilled;Old timer;Veteran;Seasoned pro;Superb;Outstanding;Master".split(";"),r={s:32,o:32,v:256,w:"s3.png",t:document.getElementById("screen")},v=2,screen,x,y,ba,ca=[31],da=[25,26,
27,28,29,30],ea=[21,22,23,24],fa=[18,19],ha=[6,12],ia=[20,30],ja=[3,4],z=[],A=[],B=[],C=[],D,F,ka=[],G,H,I=!1,L=!0,M=null,N=!1,O=!1,P=!1,Q=9,R=[],la=window.requestAnimationFrame,ma=[[2,.0266,.5034,.5728,.5999,.5026,,-.0108,-.4073,,,,,.543,.7178,.7558,,.9082,.9809,.1312,-.4545,.0055,.0025,.4],[3,.14,.31,.0939,.47,.03,.0071,-.1999,.34,.24,.0685,-.28,,.0233,-.0799,,.0104,.4403,.27,.02,.21,.12,-.18,.32],[3,,.35,.53,.2582,.1909,,.2963,,,,,,,,,.3,-.0396,1,,,,,.18],[0,,.0878,,.4572,.2507,,.2093,,.1437,.3611,
,,.5666,,,,,1,,,,,.3],[0,.34,.26,.24,.23,,,.1232,.1466,.24,1,.9299,,,-1,1,-.8,-.04,.33,-.02,,,-1,.36],[3,.0171,.9078,.3427,.4125,.5181,.0587,-.1099,.484,.0317,.4421,-.4199,.5661,.049,.0066,.2124,-.8404,-.1955,.3985,-.0415,,.0212,-.0439,.32]];function na(){ma.forEach(function(a){a=jsfxr(a);var b=new Audio;b.src=a;R.push(b)})}
function oa(){C=[];for(var a=1;7>a;a++)for(var b=1;7>b;b++)(1!=a&&2!=a||6!=b)&&(1!=a&&2!=a||7!=b)&&(0!=a&&1!=a&&2!=a||5!=b)&&C.push([a,b]);z=[];B=[];object=[];b=document.getElementById("screen").children;a=0;for(l=b.length;a<l;a++)b[a]&&b[a].parentNode&&b[a].parentNode.removeChild(b[a]);for(a=-1;9>a;a++)for(b=-1;9>b;b++){var c=p();c.b(ca[d(0,ca.length)]);-1!==a&&8!==a&&-1!==b&&8!==b||c.b(ea[d(0,ea.length)]);z.push([c,a,b,"t"])}a=p();a.b(20);z.push([a,7,0]);A=T(da,5,10,"w");A=A.concat(T(fa,1,5,"f"));
a=Math.log2(v)|0;B=T(ha,a,a,"e",{h:[0,1,2,3,4,5],l:[28,29],f:4});a=p();a.g(0);a.i({h:[0,1,2,3,4,5],l:[32,33],d:[38,39],f:6});a.a("i");D=[a,0,7,"p"];screen=document.getElementById("screen");x=n("score");x.innerHTML="<p>energy: "+G+"</p>";screen.appendChild(x);x.update=function(){x.innerHTML="<p>energy: "+G+"</p>"}}function U(a){a[0].u((a[1]+1)*r.s,(a[2]+1)*r.o)}function pa(){var a=p();a.b(46);a.i({h:[1,0],f:8});a.a("i");F=[a,D[1]+.5,D[2]-.5,"!"];g(function(){F[0].k();F=null},1E3);R[0].play()}
function T(a,b,c,f,e){b=d(b,c+1);c=[];for(var h=0;h<b;h++){var k=C.splice(d(0,C.length),1)[0],m=p(),q=d(0,a.length),w=a[q];m.b(w);if("e"!==f)q=[m,k[0],k[1],f,2],"f"===f&&(q[4]=19===w?12:20),c.push(q);else{var E=Object.assign({},e);12==w&&(E.l=[24,25]);m.i(E);m.a("i");k=[m,k[0],k[1],f];if(6==w||12==w)k[4]=ia[q],k[5]=ja[q];k[3]=f;c.push(k)}}return c}
function qa(a,b){var c=a[1];"r"==b&&c++;"l"==b&&c--;var f=a[2];"u"==b&&f--;"d"==b&&f++;for(var e=0;e<B.length;e++)if(B[e][1]==c&&B[e][2]==f&&"f"!==B[e][3])return"n";for(e=0;e<A.length;e++)if(A[e][1]==c&&A[e][2]==f)return A[e];return D[1]==c&&D[2]==f?D:"y"}function ra(a){a[4]--;1==a[4]&&a[0].g(a[0].h()+15);0>=a[4]&&(a[3]="r",a[0].k(),V(8))}
function W(a,b){O=!0;var c=qa(a,b);if("n"===c)X(a);else if("w"===c[3]||"p"===c[3]){if("p"===c[3]){c[0].a("d");V(6,a[4]);var f=!0;R[1].play()}if("w"===c[3]){var e=d(1,4);if(M!=a&&2>e){X(a);return}ra(c);R[2].play()}a[0].a("a");g(function(){a[0].a("i");f&&c[0].a("i");X(a)},500)}else{e=a[1];var h=a[2];switch(b){case "l":0<a[1]&&(e--,a[0].c(-1,0),R[4].play());break;case "r":7>a[1]&&(e++,a[0].c(1,0),R[4].play());break;case "u":0<a[2]&&(h--,a[0].c(0,-1),R[4].play());break;case "d":7>a[2]&&(h++,a[0].c(0,
1),R[4].play())}X(a,e,h)}}function sa(){A.forEach(function(a,b){if(a[1]===D[1]&&a[2]===D[2])return G+=a[4],R[3].play(),A.splice(b,1),a[0].k(),!1});if(7===D[1]&&0===D[2])return!0}
function Y(){var a=+new Date,b=a-ba;ba=a;switch(Q){case 9:y.innerHTML="<p>ROGUE SCAVENGER 13K</p>";screen.style.display="none";y.style.display="block";la(Y);return;case 5:P=!1;M=null;G=H=25;v=1;oa();Q=2;break;case 3:if(L&&!I)H<G&&(H=G),0>=G&&(P=!0,Q=7),I=!0,Z[0]?W(D,"l"):Z[2]?W(D,"r"):Z[1]?W(D,"u"):Z[3]?W(D,"d"):I=!1;else if(!L&&!N){var c=ka.pop();c?(g(function(){var a=["l","r","u","d"],b="";Math.abs(c[1]-D[1])+Math.abs(c[2]-D[2])<=c[5]?(F||M||(M=c,pa()),c[2]>D[2]?b="u":c[2]<D[2]&&(b="d"),""===b&&
(c[1]>D[1]?b="l":c[1]<D[1]&&(b="r"))):(b=a[d(0,a.length)],M==c&&(M=null));W(c,b)},250),N=!0):L=!0}break;case 2:var f=window.speechSynthesis;g(function(){var a=f.getVoices(),b=0;a.forEach(function(a,c){0<=a.lang.indexOf("en")&&"Google UK English Male"==a.name&&(b=c)});var c=new SpeechSynthesisUtterance("Day "+v+". "+(t[v-1]||""));c.voice=a[b];c.pitch=.5;c.B=.8;f.speak(c)},500);y.innerHTML="<p>DAY "+v+".</p><p class='small'>"+(t[v-1]||"")+"</p>";screen.style.display="none";y.style.display="block";Q=
4;g(function(){oa();screen.style.display="block";y.style.display="none";Q=3},2500);break;case 7:a=v>=l?u[l-1]:u[v]||u[0],y.innerHTML="<p>You DIED</p><p class='small'>of starvation after "+v+" days.<br/>You managed to have "+H+" food.<br/>"+a+" scavenger.<br/><a href='https://twitter.com/intent/tweet?url=http://www.js13kgames.com/rogue-scavenger13k&text=#js13k #scavenger13k "+("I died of starvation after "+v+" days of zombie apocalypse. I am a "+a+" scavenger.")+"' target='_blank'>TWEET IT!</a></p>",
screen.style.display="none",y.style.display="block",Q=4}ta(b);z.forEach(U);A.forEach(U);B.forEach(U);U(D);F&&U(F);la(Y)}function V(a,b){switch(a){case 0:G--;sa()?(L=!0,I=!1,M=null,R[5].play(),g(function(){v++;Q=2},1E3)):g(function(){I=L=!1;ka=B.slice(0)},250);x.update();break;case 1:N=!1;break;case 6:G-=b;x.update();break;case 8:for(var c=0;c<A.length;c++)if("r"===A[c][3]){A.splice(c,1);break}}}
function ta(a){D[0].j(a);if(O){var b=D[0].m();D[1]+=b[0]*a;D[2]+=b[1]*a}B.forEach(function(b){b[0].j(a);if(O){var c=b[0].m();b[1]+=c[0]*a;b[2]+=c[1]*a}});F&&F[0].j(a)}function X(a,b,c){g(function(){O=!1;a[0].c(0,0);b&&(a[1]=b);c&&(a[2]=c);a[1]=Math.round(a[1]);a[2]=Math.round(a[2]);"p"==a[3]?V(0):V(1)},500)}var Z=[0,0,0,0];
document.onkeyup=document.onkeydown=function(a){a.preventDefault();var b=a.keyCode-37;"keyup"==a.type?(Z[b]=0,40==b&&(gainNode.gain.value=-1==gainNode.gain.value?-.84:-1)):Z[b]=1;P&&g(Q=5,1E3)};y=document.getElementById("title");screen=document.getElementById("screen");g(function(){na();Q=5},500);Y();